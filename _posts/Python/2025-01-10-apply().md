---
layout: post
title:  "[Python] apply()메서드로 함수 적용하기" 
subtitle: 판다스 입문
tags: [pandas]
categories: Python
---
<span style="color:gray">
**By Yong Bin Kwon, with Comments by Jung In Seo**
</span>

<details open>
    <summary> Reference </summary>
        
<img width = "30%" alt = "fig1" src = "https://github.com/user-attachments/assets/59dee25b-108e-4f51-9c93-7425b38f9351" />
</details>

<details >
    <summary> Versions </summary>
 <pre>       
    Python = 3.11.11
    numpy = 1.24.0
    pandas = 2.2.3
 </pre>   
</details>

# I. 간단한 함수 만들기
- `apply()` 메서드를 사용하려면 함수가 무엇인지 알아야 한다. 함수는 파이썬 코드를 그룹화하고 재사용하는 방법이다. 같은 코드를 복사해 붙여 넣고 일부 코드만 변경해야 하는 상황이라면 이 코드는 함수로 만들 수 있다. def 키워드를 사용하여 함수를 정의할 수 있으며 함수 본문은 들여쓰기로 작성해야 한다.

~~~cpp
def my_function():
    # 이곳에 코드를 입력한다.
~~~

### 사용자 함수 만들기


```python
# 주어진 숫자의 제곱을 반환하는 함수
def my_sq(x):
    return x ** 2

# 주어진 두 숫자의 평균을 구하는 함수
def avg_2(x,y):
    return (x + y) / 2

# 함수의 도움말 추가
def avg_2(x,y):
    """두 숫자의 평균을 구하는 함수
    """
    return (x + y) / 2
```


```python
# my_sq() 함수 호출
my_calc_1 = my_sq(4)
print(my_calc_1)
```

    16



```python
# avg_2() 함수 호출
my_calc_2 = avg_2(10, 20)
print(my_calc_2)
```

    15.0


# II. apply() 메서드 사용하기
- 여기서는 데이터의 행이나 열 전체에 걸쳐 함수를 적용하는 방법을 살펴보자.

### 데이터프레임에 함수 적용하기


```python
# 데이터프레임 생성
import pandas as pd

df = pd.DataFrame({"a": [10, 20, 30],
                   "b": [20, 30, 40]})
print(df)
```

        a   b
    0  10  20
    1  20  30
    2  30  40



```python
# a 열의 모든 값을 제곱
print(df['a'] ** 2)
```

    0    100
    1    400
    2    900
    Name: a, dtype: int64


## II-1. 시리즈에 함수 적용하기
- 데이터프레임에 대괄호([])를 덧붙이면 단일 열이나 행 일부를 추출할 수 있다. 이때 반환하는 객체 유형은 판다스의 시리즈이다.

### 시리즈에 함수 적용하기


```python
# 대괄호로 a열 추출하여 유형 확인
print(type(df['a']))
```

    <class 'pandas.core.series.Series'>



```python
# 첫 번째 행 유형 확인
print(type(df.iloc[0]))
```

    <class 'pandas.core.series.Series'>


> - 시리즈는 `apply()`라는 메서드를 제공한다. 이 메서드를 사용하면 시리즈의 모든 요소에 지정한 함수를 적용할 수 있다.


```python
# 시리즈에 my_sq()함수 적용
sq = df['a'].apply(my_sq)
print(sq)
```

    0    100
    1    400
    2    900
    Name: a, dtype: int64


- [x] `apply()` 메서드에 함수 전달하기
    + `apply()` 메서드에 함수를 인수로 전달할 때는 함수 이름 옆에 소괄호를 덧붙이지 않는다. 이를 함수 팩토리라고 하는데, `apply()` 메서드로 전달하는 것은 사용할 함수의 참조로, 이 시점에는 함수를 실행하지 않는다.

### 사용자 함수 만들어 데이터프레임에 적용하기


```python
# n제곱 함수 my_exp()생성
def my_exp(x, e): # x는 제곱할 값 e는 제곱 횟수(지수)
    return x ** e 
```


```python
# 2의 3제곱 구하기
cubed = my_exp(2, 3)
print(cubed)
```

    8


- 시리즈의 `apply()` 메서드에 함수를 전달할 때 매개변수는 어떻게 전달해야 할까? 함수의 첫 번째 매개변수에는 데이터프레임이나 시리즈의 각 요솟값을 함수 호출 시점에 자동으로 전달한다. 그 밖의 다른 매개변수는 키워드 매개변수로 이름과 값을 명시하여 `apply()`에 전달해야 한다.


```python
# my_exp() 함수를 apply()에 적용하여 시리즈 요소의 제곱 구하기
ex = df['a'].apply(my_exp, e = 2)
print(ex)
```

    0    100
    1    400
    2    900
    Name: a, dtype: int64



```python
# 3제곱 구하기
ex = df['a'].apply(my_exp, e = 3)
print(ex)
```

    0     1000
    1     8000
    2    27000
    Name: a, dtype: int64


## II-2. 데이터프레임에 함수 적용하기


```python
df = pd.DataFrame({"a": [10, 20, 30],
                   "b": [20, 30, 40]})
print(df)
```

        a   b
    0  10  20
    1  20  30
    2  30  40


- 데이터프레임은 일반적으로 2개 이상의 차원으로 구성된다. 따라서 데이터프레임에 함수를 적용할 때는 함수를 적용할 축을 지정해야 한다. 즉, 열 단위로 적용할지 행 단위로 적용할지 결정해야 한다.


```python
# 하나의 값을 전달받아서 출력하는 함수
def print_me(x):
    print(x)
```

### 열 단위로 함수 적용하기


```python
# print_me() 함수를 각 열에 적용
df.apply(print_me, axis = 0)
```

    0    10
    1    20
    2    30
    Name: a, dtype: int64
    0    20
    1    30
    2    40
    Name: b, dtype: int64





    a    None
    b    None
    dtype: object



> - 함수를 열 단위로 적용하고 싶다면 `appply()` 메서드를 호출할 때 axis 매개변수에 0 또는 "index"를 지정한다. 반대로 행 단위로 함수를 적용하고 싶다면 axis = 1 또는 axis = "columns"를 전달한다. 이 책에서는 0 또는 1을 사용하여 함수 적용 축을 지정한다. axis의 기본값은 열 단위인 0이다.


```python
# print()로 각 열 출력
print(df['a'])

print(df['b'])
```

    0    10
    1    20
    2    30
    Name: a, dtype: int64
    0    20
    1    30
    2    40
    Name: b, dtype: int64


> - 출력 결과가 완전히 같다. 데이터프레임에 `apply()`로 함수를 적용하면 지정한 전체 축이 함수의 첫 번째 인수로 전달된다. 즉, `print_me()` 함수의 매개변수 x에는 데이터프레임의 각 열이 인수로 전달된다는 뜻이다.


```python
# 세 숫자의 평균을 구하는 avg_3() 함수
def avg_3(x, y, z):
    return (x + y + z) / 3
```


```python
# 전체 열을 첫 번째 인수로 받은 후에 함수 안에서 각 값을 추출
def avg_3_apply(col):
    x = col[0]
    y = col[1]
    z = col[2]
    return (x + y + z) / 3
```


```python
# avg_3_apply() 함수를 apply()로 데이터프레임에 적용 결과 확인
print(df.apply(avg_3_apply))
```

    a    20.0
    b    30.0
    dtype: float64


### 행 단위로 함수 적용하기
- 행 단위로 함수를 적용하는 방법은 열 단위로 함수를 적용하는 방법과 같다.


```python
# 행의 전체 값을 받아서 2개의 값을 추출하고 평균을 반환하는 avg_2_apply() 함수
def avg_2_apply(row):
    x = row[0]
    y = row[1]
    return (x + y) / 2
```


```python
# apply()로 avg_2_apply() 함수를 행 단위로 적용
print(df.apply(avg_2_apply, axis = 1))
```

    0    15.0
    1    25.0
    2    35.0
    dtype: float64


    /var/folders/52/9g__g13d4zjgvrl6vdg9_ln80000gn/T/ipykernel_2272/3303235818.py:3: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
      x = row[0]
    /var/folders/52/9g__g13d4zjgvrl6vdg9_ln80000gn/T/ipykernel_2272/3303235818.py:4: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
      y = row[1]


