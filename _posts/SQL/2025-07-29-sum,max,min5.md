---
layout: post
title:  "[SQL] LV.3 물고기 종류 별 대어 찾기(SUM, MAX, MIN)" 
subtitle: programmers
tags: [MySQL]
categories: SQL
---
<img width="100%" alt="Image" src="https://github.com/user-attachments/assets/576a3402-5d36-4141-8911-03a2e9c1a015" />


# 문제
<https://school.programmers.co.kr/learn/courses/30/lessons/293261>

## 테이블 구조

1. `FISH_INFO`테이블
    - `ID`: 물고기의 ID
    - `FISH_TYPE`: 물고기의 종류(숫자)
    - `LENGTH`: 잡은 물고기의 길이(cm)
    - `TIME`: 물고기를 잡은 날짜

## 1. 답안


```sql
SELECT FI.ID, FNI.FISH_NAME, FI.LENGTH
FROM FISH_INFO AS FI
JOIN FISH_NAME_INFO AS FNI ON FI.FISH_TYPE = FNI.FISH_TYPE
WHERE (FI.FISH_TYPE, FI.LENGTH) IN (
    SELECT FISH_TYPE, MAX(LENGTH)
    FROM FISH_INFO
    GROUP BY FISH_TYPE
    )
ORDER BY ID
```

## 쿼리 설명


```sql
(
    SELECT FISH_TYPE, MAX(LENGTH)
    FROM FISH_INFO
    GROUP BY FISH_TYPE
    )
```

- `FISH_TYPE`별로 그룹을 나눈 뒤,
- 각 그룹에서 최대 길이(`MAX(LENGTH)`)를 구한다.
- 결과는 `(FISH_TYPE, MAX_LENGTH)`의 튜플 형태가 된다.


```sql
CASE
        WHEN D.R > D.MAX_ID * 0.75 THEN 'CRITICAL'
        WHEN D.R > D.MAX_ID * 0.5 THEN 'HIGH'
        WHEN D.R > D.MAX_ID * 0.25 THEN 'MEDIUM'
        ELSE 'LOW'
    END AS COLONY_NAME
```

- 각 개체의 순위 R이 `MAX_ID`의 몇 % 이상인지에 따라 분류:
    + 상위 75% 초과 → 'CRITICAL'
    + 상위 50% 초과 → 'HIGH'
    + 상위 25% 초과 → 'MEDIUM'
    + 그 외 → 'LOW'
