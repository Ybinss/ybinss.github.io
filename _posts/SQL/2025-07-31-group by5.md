---
layout: post
title:  "[SQL] LV.3 자동차 대여 기록에서 대여중/대여 가능 여부 구분하기(GROUP BY)" 
subtitle: programmers
tags: [MYSQL]
categories: SQL
---
<img width="100%" alt="Image" src="https://github.com/user-attachments/assets/576a3402-5d36-4141-8911-03a2e9c1a015" />

# 문제
<https://school.programmers.co.kr/learn/courses/30/lessons/157340>

## 테이블 구조

1. `CAR_RENTAL_COMPANY_RENTAL_HISTORY`테이블
    - `HISTORY_ID`: 자동차 대여 기록 ID
    - `CAR_ID`: 자동차 ID
    - `START_DATE`: 대여 시작일
    - `END_DATE`: 대여 종료일

## 1. 답안


```sql
SELECT 
    CAR_ID, 
    MAX(
        CASE 
            WHEN '2022-10-16' BETWEEN TO_CHAR(START_DATE, 'YYYY-MM-DD') AND TO_CHAR(END_DATE, 'YYYY-MM-DD')
            THEN '대여중' 
            ELSE '대여 가능' 
        END
    ) AS AVAILABILITY
FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
GROUP BY CAR_ID
ORDER BY CAR_ID DESC;
```

## 쿼리 설명

### 1. 서브쿼리


```sql
CASE 
    WHEN '2022-10-16' BETWEEN TO_CHAR(START_DATE, 'YYYY-MM-DD') AND TO_CHAR(END_DATE, 'YYYY-MM-DD')
    THEN '대여중' 
    ELSE '대여 가능' 
END
```

- `'2022-10-16'`이 각 차량의 대여 시작일과 종료일 사이에 있다면 `'대여중'`으로 판단한다.
- 날짜 형식을 비교하기 위해 `TO_CHAR(..., 'YYYY-MM-DD')`로 변환해 문자열로 비교하고 있다.
- 그렇지 않으면 `대여 가능`으로 판단한다.

### 2. MAX 함수의 목적


```sql
MAX(...)
```

- 하나의 차량(`CAR_ID`)은 여러 대여 이력을 가질 수 있으므로,
- 여려 이력 중 하나라도 `'대여중'`이면 **최종적으로 `'대여중'`**이 되도록 하기 위해 `MAX()`사용
- 문자 비교에서 `대여중` > `대여 가능`이므로, 대여중이 우선으로 올라온다.
