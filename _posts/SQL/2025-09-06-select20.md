---
layout: post
title:  "[SQL] LV.4 특정 세대의 대장균 찾기(SELECT)" 
subtitle: programmers
tags: [MySQL]
categories: SQL
---
<img width="100%" alt="Image" src="https://github.com/user-attachments/assets/576a3402-5d36-4141-8911-03a2e9c1a015" />

# 문제
<https://school.programmers.co.kr/learn/courses/30/lessons/301650>

## 테이블 구조

1. `ECOLI_DATA`테이블
    - `ID`: 대장균 개체의 ID
    - `PARENT_ID`: 부모 개체의 ID
    - `SIZE_OF_COLOLY`: 개체의 크기
    - `DIFFERENTIATION_DATE`: 분화되어 나온 날짜
    - `GENOTYPE`: 개체의 형질

## 1. 답안 (JOIN)


```sql
SELECT F.ID
FROM ECOLI_DATA AS F
JOIN ECOLI_DATA AS S ON F.PARENT_ID = S.ID
JOIN ECOLI_DATA AS T ON S.PARENT_ID = T.ID
WHERE T.PARENT_ID IS NULL
ORDER BY F.ID
```

## 쿼리 설명


```sql
FROM ECOLI_DATA AS F
JOIN ECOLI_DATA AS S ON F.PARENT_ID = S.ID
JOIN ECOLI_DATA AS T ON S.PARENT_ID = T.ID
```

- 같은 테이블을 별칭으로 세 번 불러 계층 관계를 표현한다.
    + `F`: 우리가 최종적으로 뽑으려는 노드(손자)
    + `S`: F의 부모
    + `T`: S의 부모 


```sql
WHERE T.PARENT_ID IS NULL
```

- `F`는 루트의 손자에 해당하는 노드만 남는다.

## 2. 답안 (서브쿼리 + IN)


```sql
SELECT ED3.ID
FROM ECOLI_DATA AS ED3
WHERE ED3.PARENT_ID IN (
    SELECT ED2.ID
    FROM ECOLI_DATA AS ED2
    WHERE ED2.PARENT_ID IN (
        SELECT ED.ID
        FROM ECOLI_DATA AS ED
        WHERE ED.PARENT_ID IS NULL
    )
)
ORDER BY ED3.ID
```

## 쿼리 설명

### 1. 가장 안쪽 서브쿼리


```sql
SELECT ED.ID
FROM ECOLI_DATA AS ED
WHERE ED.PARENT_ID IS NULL
```

- 부모가 없는 노드의 ID 목록을 구한다.

### 2. 중간 서브쿼리


```sql
    SELECT ED2.ID
    FROM ECOLI_DATA AS ED2
    WHERE ED2.PARENT_ID IN (...)
```

- 방금 구한 루트들의 자식 ID 목록(`ED2.ID`)을 구한다.

### 3. 바깥 쿼리


```sql
SELECT ED3.ID
FROM ECOLI_DATA AS ED3
WHERE ED3.PARENT_ID IN (...)
```

- 루트의 자식들을 부모로 갖는 손자 노드(`ED3`)의 ID만 선택한다.
