---
layout: post
title:  "[SQL] LV.4 저자 별 카테고리 별 매출액 집계하기(GROUP BY)" 
subtitle: programmers
tags: [MYSQL]
categories: SQL
---
<img width="100%" alt="Image" src="https://github.com/user-attachments/assets/576a3402-5d36-4141-8911-03a2e9c1a015" />

# 문제
<https://school.programmers.co.kr/learn/courses/30/lessons/144856>

## 테이블 구조

1. `BOOK`테이블
    - `BOOK_ID`: 도서 ID
    - `CATEGORY`: 카테고리
    - `AUTHOR_ID`: 저자 ID
    - `PRICE`: 판매가 (원)
    - `PUBLISHED_DATE`: 출판일
2. `AUTHOR`테이블
    - `AUTHOR_ID`: 저자 ID
    - `AUTHOR_NAME`: 저자명
3. `BOOK_SALES`테이블
    - `BOOK_ID`: 도서 ID
    - `SALES_DATE`: 판매일
    - `SALES`: 판매량

## 답안


```sql
SELECT B.AUTHOR_ID, A.AUTHOR_NAME, B.CATEGORY, SUM(BS.SALES * B.PRICE) AS TOTAL_SALES
FROM BOOK B, AUTHOR A, BOOK_SALES BS
WHERE B.AUTHOR_ID = A.AUTHOR_ID
    AND B.BOOK_ID = BS.BOOK_ID
    AND TO_CHAR(BS.SALES_DATE, 'YYYY-MM') = '2022-01'
GROUP BY B.AUTHOR_ID, A.AUTHOR_NAME, B.CATEGORY
ORDER BY B.AUTHOR_ID, B.CATEGORY DESC
```

## 쿼리 설명


```sql
GROUP BY B.AUTHOR_ID, A.AUTHOR_NAME, B.CATEGORY
```

- 저자 ID + 저자 이름 + 도서 카테고리 별로 묶어서 총합을 계산한다.
- `SELECT`에 집계 함수(`SUM`)를 제외한 컬럼은 반드시 `GROUP BY`에 포함되어야 한다.


```sql
SUM(BS.SALES * B.PRICE)
```

- 판매 수량 * 가격을 합산해 매출을 구한다.
