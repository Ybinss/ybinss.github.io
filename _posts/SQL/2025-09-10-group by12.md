---
layout: post
title:  "[SQL] LV.4 년, 월, 성별 별 상품 구매 회원 수 구하기(GROUP BY)" 
subtitle: programmers
tags: [MYSQL]
categories: SQL
---
<img width="100%" alt="Image" src="https://github.com/user-attachments/assets/576a3402-5d36-4141-8911-03a2e9c1a015" />

# 문제
<https://school.programmers.co.kr/learn/courses/30/lessons/131532>

## 테이블 구조

1. `USER_INFO`테이블
    - `USER_ID`: 회원 ID
    - `GENDER`: 성별
    - `AGE`: 나이
    - `JOINED`: 가입일
2. `ONLINE_SALE`테이블
    - `ONLINE_SALE_ID`: 판매 ID
    - `USER_ID`: 회원 ID
    - `PRODUCT_ID`: 상품 ID
    - `SALES_AMOUNT`: 판매량
    - `SALES_DATE`: 판매일

## 답안


```sql
SELECT 
  YEAR(O.SALES_DATE) AS YEAR,
  MONTH(O.SALES_DATE) AS MONTH,
  U.GENDER,
  COUNT(DISTINCT U.USER_ID) AS USERS
FROM USER_INFO U
JOIN ONLINE_SALE O ON U.USER_ID = O.USER_ID
WHERE U.GENDER IS NOT NULL
GROUP BY YEAR(O.SALES_DATE), MONTH(O.SALES_DATE), U.GENDER
ORDER BY YEAR, MONTH, U.GENDER
```

## 쿼리 설명


```sql
COUNT(DISTINCT U.USER_ID) AS USERS
```

- 같은 사용자가 같은 달에 여러 번 결제해도 1명으로 카운트된다.
- 한 사용자가 다른 달에도 구매했다면 그 달 그룹에서도 다시 1명으로 카운트된다.
