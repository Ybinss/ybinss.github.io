---
layout: post
title:  "[SQL] LV.4 연간 평가점수에 해당하는 평가 등급 및 성과금 조회하기(GROUP BY)" 
subtitle: programmers
tags: [MySQL]
categories: SQL
---
<img width="100%" alt="Image" src="https://github.com/user-attachments/assets/576a3402-5d36-4141-8911-03a2e9c1a015" />

# 문제
<https://school.programmers.co.kr/learn/courses/30/lessons/284528>

## 테이블 구조

1. `HR_DEPARTMENT`테이블
    - `DEPT_ID`: 부서 ID
    - `DEPT_NAME_KR`: 국문 부서명
    - `DEPT_NAME_EN`: 영문 부서명
    - `LOCATION`: 부서 위치
2. `HR_EMPLOYEES`테이블
    - `EMP_NO`: 사번
    - `EMP_NAME`: 성명
    - `DEPT_ID`: 부서 ID
    - `POSITION`: 직책
    - `EMAIL`: 이메일
    - `COMP_TEL`: 전화번호
    - `HIRE_DATE`: 입사일
    - `SAL`: 연봉
3. `HR_GRADE`테이블
    - `EMP_NO`: 사번
    - `YEAR`: 연도
    - `HALF_YEAR`: 반기
    - `SCORE`: 평가 점수

## 답안


```sql
SELECT 
    E.EMP_NO, 
    E.EMP_NAME, 
    CASE
        WHEN AVG(G.SCORE) >= 96 THEN 'S'
        WHEN AVG(G.SCORE) >= 90 THEN 'A'
        WHEN AVG(G.SCORE) >= 80 THEN 'B'
        ELSE 'C'
    END AS GRADE, 
    CASE
        WHEN AVG(G.SCORE) >= 96 THEN E.SAL * 0.2
        WHEN AVG(G.SCORE) >= 90 THEN E.SAL * 0.15
        WHEN AVG(G.SCORE) >= 80 THEN E.SAL * 0.1
        ELSE 0
    END AS BONUS
FROM HR_EMPLOYEES E
JOIN HR_DEPARTMENT D ON E.DEPT_ID = D.DEPT_ID
JOIN HR_GRADE G ON E.EMP_NO = G.EMP_NO
GROUP BY E.EMP_NO
ORDER BY E.EMP_NO
```

## 쿼리 설명

- `CASE`로 등급/보너스 기준을 나누고, `AVG(G.SCORE)`집계를 기준으로 판단함
