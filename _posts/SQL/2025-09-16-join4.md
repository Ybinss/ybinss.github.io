---
layout: post
title:  "[SQL] LV.4 특정 기간동안 대여 가능한 자동차들의 대여비용 구하기(JOIN)" 
subtitle: programmers
tags: [Oracle]
categories: SQL
---
<img width="100%" alt="Image" src="https://github.com/user-attachments/assets/576a3402-5d36-4141-8911-03a2e9c1a015" />

# 문제
<https://school.programmers.co.kr/learn/courses/30/lessons/157339>

## 테이블 구조

1. `CAR_RENTAL_COMPANY_CAR`테이블
    - `CAR_ID`: 자동차 ID
    - `CAR_TYPE`: 자동차 종류
    - `DAILY_FEE`: 일일 대여 요금(원)
    - `OPTIONS`: 자동차 옵션 리스트
2. `CAR_RENTAL_COMPANY_RENTAL_HISTORY`테이블
    - `HISTORY_ID`: 자동차 대여 기록 ID
    - `CAR_ID`: 자동차 ID
    - `START_DATE`: 대여 시작일
    - `END_DATE`: 대여 종료일
3. `CAR_RENTAL_COMPANY_DISCOUNT_PLAN`테이블
    - `PLAN_ID`: 요금 할인 정책 ID
    - `CAR_TYPE`: 자동차 종류
    - `DURATION_TYPE`: 대여 기간 종류
    - `DISCOUNT_RATE`: 할인율(%)

## 답안


```sql
SELECT 
    C.CAR_ID, 
    C.CAR_TYPE, 
    ROUND(C.DAILY_FEE * 30 * (100 - P.DISCOUNT_RATE) / 100) AS FEE
FROM CAR_RENTAL_COMPANY_CAR C
JOIN CAR_RENTAL_COMPANY_RENTAL_HISTORY H ON C.CAR_ID = H.CAR_ID
JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN P ON C.CAR_TYPE = P.CAR_TYPE
WHERE C.CAR_ID NOT IN (
    SELECT CAR_ID
    FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
    WHERE END_DATE > '2022-11-01' AND START_DATE < '2022-12-01'
) AND P.DURATION_TYPE = '30일 이상'
GROUP BY C.CAR_ID
HAVING C.CAR_TYPE IN ('세단', 'SUV') AND (FEE >= 500000 AND FEE < 2000000)
ORDER BY FEE DESC, CAR_TYPE, CAR_ID DESC
```

## 쿼리 설명


```sql
ROUND(C.DAILY_FEE * 30 * (100 - P.DISCOUNT_RATE) / 100) AS FEE
```

- 일일요금 * 30일 * (할인율 적용)을 정수로 반올림


```sql
C.CAR_ID NOT IN (
    SELECT CAR_ID
    FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY
    WHERE END_DATE > '2022-11-01' AND START_DATE < '2022-12-01'
```

- 11월 내내 빌릴 수 있는 (겹치지 않는) 차량만 남긴다.
