---
layout: post
title:  "[SQL] LV.5 상품을 구매한 회원 비율 구하기(JOIN)" 
subtitle: programmers
tags: [Oracle]
categories: SQL
---
<img width="100%" alt="Image" src="https://github.com/user-attachments/assets/576a3402-5d36-4141-8911-03a2e9c1a015" />

# 문제
<https://school.programmers.co.kr/learn/courses/30/lessons/131534>

## 테이블 구조

1. `USER_INFO`테이블
    - `USER_ID`: 회원 ID
    - `GENDER`: 성별
    - `AGE`: 나이
    - `JOINED`: 가입일
2. `ONLINE_SALE`테이블
    - `ONLINE_SALE_ID`: 판매 ID
    - `USER_ID`: 회원 ID
    - `PRODUCT_ID`: 상품 ID
    - `SALES_AMOUNT`: 판매량
    - `SALES_DATE`: 판매일

## 답안


```sql
SELECT TO_CHAR(SALES_DATE,'YYYY') YEAR
        ,TO_NUMBER(TO_CHAR(SALES_DATE,'MM')) MONTH
        ,COUNT(DISTINCT(USER_ID)) PURCHASED_USERS
        ,ROUND(COUNT(DISTINCT(USER_ID))/(
            SELECT COUNT(USER_ID)
            FROM USER_INFO
            WHERE TO_CHAR(JOINED,'YYYY') ='2021'
        ),1) PUCHASED_RATIO
FROM ONLINE_SALE 
WHERE USER_ID IN (
    SELECT USER_ID
    FROM USER_INFO 
    WHERE TO_CHAR(JOINED,'YYYY') = '2021'
)
GROUP BY TO_CHAR(SALES_DATE,'YYYY'),TO_CHAR(SALES_DATE,'MM')
ORDER BY 1, 2
```

## 쿼리 설명


```sql
COUNT(DISTINCT(USER_ID)) PURCHASED_USERS
```

- 해당 연/월에 구매한 회원 수를 중복 제거해서 센다.
- 한 사람이 그 달에 여러 번 구매해도 1명으로 카운트한다.


```sql
ROUND(COUNT(DISTINCT(USER_ID))/(
            SELECT COUNT(USER_ID)
            FROM USER_INFO
            WHERE TO_CHAR(JOINED,'YYYY') ='2021'
        ),1) PUCHASED_RATIO
```

- 분자: 그 월의 구매 유니크 회원 수
- 분모: 2021년에 가입한 전체 회원 수
- 즉, 2021 가입자 중 그 달에 구매한 비율


```sql

```
